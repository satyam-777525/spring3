<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Management System</title>
    <style>
        :root {
          --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #4c1d95 100%);
          --card-bg: rgba(15, 23, 42, 0.9);
          --card-border: rgba(148, 163, 184, 0.4);
          --accent: #6366f1;
          --accent-soft: rgba(99, 102, 241, 0.15);
          --accent-hover: #4f46e5;
          --danger: #ef4444;
          --danger-hover: #dc2626;
          --success: #22c55e;
          --success-hover: #16a34a;
          --muted: #9ca3af;
          --text-main: #e5e7eb;
          --text-strong: #f9fafb;
          --radius-lg: 16px;
          --radius-md: 10px;
          --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.55);
          --shadow-chip: 0 6px 18px rgba(15, 23, 42, 0.6);
          --transition-fast: 0.18s ease-out;
          --transition-med: 0.25s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
          font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
          background: var(--bg-gradient);
          min-height: 100vh;
          padding: 24px;
          color: var(--text-main);
        }

        .app-shell {
          max-width: 1280px;
          margin: 0 auto;
          background: rgba(15, 23, 42, 0.9);
          border-radius: var(--radius-lg);
          box-shadow: var(--shadow-soft);
          border: 1px solid var(--card-border);
          backdrop-filter: blur(18px);
          padding: 18px 20px 20px;
        }

        .app-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 12px;
          margin-bottom: 18px;
          border-bottom: 1px solid rgba(55, 65, 81, 0.8);
          padding-bottom: 10px;
        }

        .brand {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .brand-badge {
          width: 38px;
          height: 38px;
          border-radius: 12px;
          background: radial-gradient(circle at 0 0, #a855f7, #6366f1 40%, #22d3ee);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: 700;
          font-size: 18px;
          box-shadow: var(--shadow-chip);
        }

        .brand-text h1 {
          font-size: 18px;
          font-weight: 700;
          color: var(--text-strong);
        }

        .brand-text span {
          font-size: 12px;
          color: var(--muted);
        }

        .header-meta {
          display: flex;
          align-items: center;
          gap: 8px;
          flex-wrap: wrap;
          justify-content: flex-end;
        }

        .pill {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          border-radius: 999px;
          font-size: 12px;
          background: var(--accent-soft);
          color: #c7d2fe;
          border: 1px solid rgba(129, 140, 248, 0.6);
        }

        .sync-button {
          padding: 6px 12px;
          border-radius: 999px;
          border: 1px solid rgba(148, 163, 184, 0.5);
          background: rgba(15, 23, 42, 0.8);
          color: var(--text-main);
          font-size: 13px;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          cursor: pointer;
          transition: background var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
        }

        .sync-button:hover {
          background: rgba(30, 64, 175, 0.7);
          border-color: rgba(129, 140, 248, 0.9);
          transform: translateY(-1px);
        }

        .message {
          padding: 8px 12px;
          border-radius: 999px;
          margin: 10px 0;
          display: none;
          font-size: 13px;
          display: inline-flex;
          align-items: center;
          gap: 8px;
          border: 1px solid transparent;
        }

        .message.success {
          background: rgba(22, 163, 74, 0.17);
          color: #bbf7d0;
          border-color: rgba(74, 222, 128, 0.7);
        }

        .message.error {
          background: rgba(185, 28, 28, 0.18);
          color: #fecaca;
          border-color: rgba(248, 113, 113, 0.75);
        }

        .message span.tag {
          font-size: 11px;
          text-transform: uppercase;
          letter-spacing: 0.12em;
          opacity: 0.85;
        }

        .loading {
          font-size: 13px;
          color: #a5b4fc;
          display: none;
          align-items: center;
          gap: 8px;
          margin-left: 10px;
        }

        .loading-dot {
          width: 5px;
          height: 5px;
          border-radius: 999px;
          background: #a5b4fc;
          animation: pulse 0.9s ease-in-out infinite alternate;
        }

        .loading-dot:nth-child(2) { animation-delay: 0.15s; }
        .loading-dot:nth-child(3) { animation-delay: 0.3s; }

        @keyframes pulse {
          from { transform: translateY(0); opacity: 0.4; }
          to   { transform: translateY(-4px); opacity: 1; }
        }

        /* Top two-column forms */

        .top-grid {
          display: grid;
          grid-template-columns: repeat(2, minmax(0, 1fr));
          gap: 16px;
          margin-top: 10px;
          margin-bottom: 16px;
        }

        @media (max-width: 900px) {
          .top-grid { grid-template-columns: 1fr; }
        }

        .form-section {
          background: rgba(17, 24, 39, 0.95);
          border-radius: var(--radius-md);
          padding: 16px 16px 12px;
          border: 1px solid var(--card-border);
        }

        .form-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
        }

        .form-header h3 {
          font-size: 16px;
          font-weight: 600;
          color: var(--text-strong);
        }

        .form-header span {
          font-size: 11px;
          color: var(--muted);
          text-transform: uppercase;
          letter-spacing: 0.14em;
        }

        .form-group { margin-bottom: 12px; }

        label {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 4px;
          font-size: 13px;
          color: var(--muted);
        }

        label span.required {
          color: #f97316;
          font-size: 11px;
          text-transform: uppercase;
          letter-spacing: 0.14em;
        }

        input {
          width: 100%;
          padding: 9px 10px;
          border-radius: 8px;
          border: 1px solid rgba(55, 65, 81, 0.8);
          background: rgba(15, 23, 42, 0.9);
          color: var(--text-main);
          font-size: 14px;
          outline: none;
          transition: border-color var(--transition-med), box-shadow var(--transition-med), background var(--transition-med), transform var(--transition-fast);
        }

        input::placeholder { color: #6b7280; }

        input:focus {
          border-color: var(--accent);
          box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.6);
          background: rgba(15, 23, 42, 0.98);
          transform: translateY(-0.5px);
        }

        .btn-row {
          display: flex;
          justify-content: flex-end;
          gap: 8px;
          margin-top: 4px;
        }

        .btn {
          padding: 8px 14px;
          border-radius: 999px;
          border: none;
          font-size: 13px;
          font-weight: 500;
          cursor: pointer;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          transition: background var(--transition-med), box-shadow var(--transition-med), transform var(--transition-fast), opacity 0.12s;
          white-space: nowrap;
        }

        .btn:disabled { opacity: 0.6; cursor: default; transform: none; }

        .btn-primary {
          background: linear-gradient(135deg, #4f46e5, #a855f7);
          color: white;
          box-shadow: 0 10px 25px rgba(79, 70, 229, 0.45);
        }

        .btn-primary:hover:not(:disabled) {
          background: linear-gradient(135deg, #4338ca, #9333ea);
          transform: translateY(-1px);
        }

        .btn-success {
          background: linear-gradient(135deg, #16a34a, #22c55e);
          color: white;
          box-shadow: 0 10px 25px rgba(34, 197, 94, 0.4);
        }

        .btn-success:hover:not(:disabled) {
          background: linear-gradient(135deg, #15803d, #22c55e);
          transform: translateY(-1px);
        }

        .btn-ghost {
          background: transparent;
          color: var(--muted);
          border: 1px solid rgba(148, 163, 184, 0.35);
        }

        .btn-ghost:hover:not(:disabled) {
          background: rgba(15, 23, 42, 0.8);
          color: var(--text-main);
          transform: translateY(-1px);
        }

        .btn-danger {
          background: var(--danger);
          color: white;
        }

        .btn-danger:hover:not(:disabled) {
          background: var(--danger-hover);
          transform: translateY(-1px);
        }

        /* Bottom list with search */

        .bottom-section {
          margin-top: 10px;
          background: rgba(15, 23, 42, 0.97);
          border-radius: var(--radius-md);
          border: 1px solid var(--card-border);
          padding: 14px 14px 12px;
        }

        .students-toolbar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 10px;
          margin-bottom: 8px;
          flex-wrap: wrap;
        }

        .students-toolbar h2 {
          font-size: 16px;
          font-weight: 600;
          color: var(--text-strong);
        }

        .students-count {
          font-size: 12px;
          color: var(--muted);
        }

        .search-bar-wrapper {
          display: flex;
          align-items: center;
          gap: 8px;
          flex: 1;
          justify-content: flex-end;
        }

        .search-input {
          max-width: 220px;
          width: 100%;
          padding: 7px 10px;
          border-radius: 999px;
          border: 1px solid rgba(55, 65, 81, 0.9);
          background: rgba(15, 23, 42, 0.9);
          color: var(--text-main);
          font-size: 13px;
          outline: none;
          transition: border-color var(--transition-med), box-shadow var(--transition-med);
        }

        .search-input::placeholder { color: #6b7280; }

        .search-input:focus {
          border-color: var(--accent);
          box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.5);
        }

        .students-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
          gap: 12px;
          margin-top: 8px;
        }

        .student-card {
          background: rgba(15, 23, 42, 0.95);
          border-radius: 14px;
          border: 1px solid rgba(51, 65, 85, 0.9);
          padding: 12px 12px 10px;
          transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast), background var(--transition-fast);
          position: relative;
          overflow: hidden;
        }

        .student-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 14px 36px rgba(15, 23, 42, 0.85);
          border-color: rgba(129, 140, 248, 0.8);
          background: rgba(17, 24, 39, 0.98);
        }

        .student-title-row {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 4px;
        }

        .student-name {
          font-size: 15px;
          font-weight: 600;
          color: var(--text-strong);
        }

        .student-id-pill {
          font-size: 11px;
          border-radius: 999px;
          padding: 3px 8px;
          background: rgba(15, 23, 42, 0.9);
          border: 1px solid rgba(148, 163, 184, 0.5);
          color: var(--muted);
        }

        .student-meta {
          font-size: 13px;
          color: var(--muted);
          margin: 2px 0;
        }

        .student-meta strong { color: var(--text-main); font-weight: 500; }

        .actions {
          margin-top: 8px;
          display: flex;
          gap: 6px;
        }

        .actions .btn {
          flex: 1;
          justify-content: center;
          padding-block: 6px;
          font-size: 12px;
        }

        .actions .btn-success {
          background: rgba(34, 197, 94, 0.12);
          border: 1px solid rgba(34, 197, 94, 0.7);
          color: #bbf7d0;
        }

        .actions .btn-success:hover:not(:disabled) {
          background: rgba(34, 197, 94, 0.18);
        }

        .actions .btn-danger {
          background: rgba(239, 68, 68, 0.12);
          border: 1px solid rgba(248, 113, 113, 0.8);
          color: #fecaca;
        }

        .actions .btn-danger:hover:not(:disabled) {
          background: rgba(239, 68, 68, 0.2);
        }

        .empty-state {
          grid-column: 1 / -1;
          text-align: center;
          padding: 32px 12px;
          color: var(--muted);
          font-size: 14px;
        }

        .empty-state span {
          display: block;
          margin-top: 4px;
          font-size: 13px;
          color: #a5b4fc;
        }
    </style>
</head>
<body>
<div class="app-shell">
    <header class="app-header">
        <div class="brand">
            <div class="brand-badge">S</div>
            <div class="brand-text">
                <h1>Student Admin</h1>
                <span>Management Console</span>
            </div>
        </div>
        <div class="header-meta">
            <div class="pill">
                • Connected
                <span style="opacity: 0.8;">API: localhost:8080</span>
            </div>
            <button class="sync-button" onclick="loadStudents()">
                ⟳ Refresh list
            </button>
            <div class="loading" id="loading">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <span>Syncing…</span>
            </div>
        </div>
    </header>

    <div id="message" class="message">
        <span class="tag">Status</span>
        <span id="messageText"></span>
    </div>

    <!-- Top: Add (left), Update (right) -->
    <div class="top-grid">
        <!-- Add Student -->
        <section class="form-section">
            <div class="form-header">
                <h3>Add new student</h3>
                <span>create</span>
            </div>
            <form id="addStudentForm">
                <div class="form-group">
                    <label for="name">
                        Name <span class="required">required</span>
                    </label>
                    <input id="name" name="name" type="text"
                           placeholder="e.g. Ananya Sharma" required />
                </div>
                <div class="form-group">
                    <label for="age">
                        Age <span class="required">required</span>
                    </label>
                    <input id="age" name="age" type="number" min="5" max="90"
                           placeholder="e.g. 21" required />
                </div>
                <div class="form-group">
                    <label for="email">
                        Email <span class="required">required</span>
                    </label>
                    <input id="email" name="email" type="email"
                           placeholder="student@example.com" required />
                </div>
                <div class="btn-row">
                    <button type="reset" class="btn btn-ghost">Clear</button>
                    <button type="submit" class="btn btn-primary">➕ Add student</button>
                </div>
            </form>
        </section>

        <!-- Update Student -->
        <section class="form-section">
            <div class="form-header">
                <h3>Update student</h3>
                <span>edit</span>
            </div>
            <form id="updateStudentForm">
                <div class="form-group">
                    <label for="updateId">
                        Student ID <span class="required">required</span>
                    </label>
                    <input id="updateId" name="id" type="text"
                           placeholder="Click ‘Edit’ on a student card" required />
                </div>
                <div class="form-group">
                    <label for="updateName">
                        Name <span class="required">required</span>
                    </label>
                    <input id="updateName" name="name" type="text"
                           placeholder="Updated name" required />
                </div>
                <div class="form-group">
                    <label for="updateAge">
                        Age <span class="required">required</span>
                    </label>
                    <input id="updateAge" name="age" type="number" min="5" max="90"
                           placeholder="Updated age" required />
                </div>
                <div class="form-group">
                    <label for="updateEmail">
                        Email <span class="required">required</span>
                    </label>
                    <input id="updateEmail" name="email" type="email"
                           placeholder="Updated email" required />
                </div>
                <div class="btn-row">
                    <button type="reset" class="btn btn-ghost">Reset</button>
                    <button type="submit" class="btn btn-success">✎ Save changes</button>
                </div>
            </form>
        </section>
    </div>

    <!-- Bottom: list + search -->
    <section class="bottom-section">
        <div class="students-toolbar">
            <div>
                <h2>All students</h2>
                <div class="students-count" id="studentsCountLabel">Loading…</div>
            </div>
            <div class="search-bar-wrapper">
                <input
                        id="searchInput"
                        type="text"
                        class="search-input"
                        placeholder="Search by name or email..."
                        oninput="applySearchFilter()"
                />
                <button class="btn btn-ghost" onclick="loadStudents()">⟳</button>
            </div>
        </div>
        <div id="studentsGrid" class="students-grid"></div>
    </section>
</div>

<script>
    const API_BASE_URL = "http://localhost:8080/api/students";
    let allStudents = []; // full list from server, used for search/filter

    function showMessage(text, type) {
      const messageDiv = document.getElementById("message");
      const messageText = document.getElementById("messageText");
      messageText.textContent = text;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = "inline-flex";
      setTimeout(() => {
        messageDiv.style.display = "none";
      }, 4000);
    }

    function showLoading(show) {
      document.getElementById("loading").style.display = show ? "inline-flex" : "none";
    }

    function updateCountLabel(count) {
      const label = document.getElementById("studentsCountLabel");
      if (typeof count !== "number") {
        label.textContent = "–";
        return;
      }
      label.textContent = count === 0 ? "No students yet" : `${count} student(s) shown`;
    }

    // Add student
    document.getElementById("addStudentForm")
      .addEventListener("submit", async (e) => {
        e.preventDefault();
        const student = {
          name: document.getElementById("name").value.trim(),
          age: parseInt(document.getElementById("age").value, 10),
          email: document.getElementById("email").value.trim(),
        };
        if (!student.name || !student.email || isNaN(student.age)) {
          showMessage("Please fill all required fields.", "error");
          return;
        }

        try {
          showLoading(true);
          const response = await fetch(API_BASE_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student),
          });

          if (response.ok) {
            const data = await response.json().catch(() => ({}));
            showMessage(data.message || "Student added successfully.", "success");
            document.getElementById("addStudentForm").reset();
            await loadStudents();
          } else {
            const errorData = await response.json().catch(() => ({}));
            const errorMsg =
              errorData.message ||
              (errorData.errors ? JSON.stringify(errorData.errors) : "") ||
              "Failed to add student.";
            showMessage(errorMsg, "error");
          }
        } catch (err) {
          showMessage("Network error: " + err.message, "error");
        } finally {
          showLoading(false);
        }
      });

    // Update student (PUT by Mongo id)
    document.getElementById("updateStudentForm")
      .addEventListener("submit", async (e) => {
        e.preventDefault();
        const id = document.getElementById("updateId").value.trim(); // this should be Mongo _id
        const student = {
          name: document.getElementById("updateName").value.trim(),
          age: parseInt(document.getElementById("updateAge").value, 10),
          email: document.getElementById("updateEmail").value.trim(),
        };
        if (!id || !student.name || !student.email || isNaN(student.age)) {
          showMessage("Please fill all required fields.", "error");
          return;
        }

        try {
          showLoading(true);
          const response = await fetch(`${API_BASE_URL}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student),
          });

          if (response.ok) {
            const data = await response.json().catch(() => ({}));
            showMessage(data.message || "Student updated successfully.", "success");
            document.getElementById("updateStudentForm").reset();
            await loadStudents();
          } else {
            const errorData = await response.json().catch(() => ({}));
            const errorMsg =
              errorData.message ||
              (errorData.errors ? JSON.stringify(errorData.errors) : "") ||
              "Failed to update student.";
            showMessage(errorMsg, "error");
          }
        } catch (err) {
          showMessage("Network error: " + err.message, "error");
        } finally {
          showLoading(false);
        }
      });

    async function loadStudents() {
      try {
        showLoading(true);
        const res = await fetch(API_BASE_URL);
        if (!res.ok) {
          const errData = await res.json().catch(() => ({}));
          showMessage("Error loading students: " + (errData.message || "Unknown error."), "error");
          allStudents = [];
          displayStudents(allStudents);
          return;
        }
        const data = await res.json();
        allStudents = Array.isArray(data) ? data : [];
        applySearchFilter(); // re-filter based on current search
      } catch (err) {
        showMessage("Network error: " + err.message, "error");
        allStudents = [];
        displayStudents(allStudents);
      } finally {
        showLoading(false);
      }
    }

    function applySearchFilter() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      if (!query) {
        displayStudents(allStudents);
        return;
      }
      const filtered = allStudents.filter((s) => {
        const name = (s.name || "").toLowerCase();
        const email = (s.email || "").toLowerCase();
        return name.includes(query) || email.includes(query);
      });
      displayStudents(filtered);
    }

    function displayStudents(students) {
      const grid = document.getElementById("studentsGrid");
      if (!Array.isArray(students)) students = [];
      updateCountLabel(students.length);

      if (students.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            No students found.
            <span>Add a student or adjust your search.</span>
          </div>`;
        return;
      }

      grid.innerHTML = students
        .map(
          (s) => `
        <div class="student-card">
          <div class="student-title-row">
            <div class="student-name">${s.name || "Unnamed"}</div>
            <div class="student-id-pill">ID: ${s.id}</div>
          </div>
          <p class="student-meta"><strong>Age:</strong> ${s.age}</p>
          <p class="student-meta"><strong>Email:</strong> ${s.email}</p>
          <div class="actions">
            <button
              class="btn btn-success"
              onclick="fillUpdateForm('${s.id}', '${escapeQuotes(s.name)}', ${s.age}, '${escapeQuotes(s.email)}')">
              Edit
            </button>
            <button
              class="btn btn-danger"
              onclick="deleteStudent('${s.id}')">
              Delete
            </button>
          </div>
        </div>`
        )
        .join("");
    }

    function escapeQuotes(str = "") {
      return String(str).replace(/'/g, "\\'").replace(/"/g, "&quot;");
    }

    function fillUpdateForm(id, name, age, email) {
      document.getElementById("updateId").value = id;
      document.getElementById("updateName").value = name;
      document.getElementById("updateAge").value = age;
      document.getElementById("updateEmail").value = email;
      document.getElementById("updateStudentForm")
        .scrollIntoView({ behavior: "smooth", block: "center" });
      showMessage("Loaded student into Update form.", "success");
    }

    async function deleteStudent(id) {
      if (!confirm("Are you sure you want to delete this student?")) return;
      try {
        showLoading(true);
        const res = await fetch(`${API_BASE_URL}/${id}`, { method: "DELETE" });
        if (!res.ok) {
          const errData = await res.json().catch(() => ({}));
          showMessage(errData.message || "Failed to delete student.", "error");
          return;
        }
        const msg = (await res.text()) || "Student deleted.";
        showMessage(msg, "success");
        await loadStudents();
      } catch (err) {
        showMessage("Network error: " + err.message, "error");
      } finally {
        showLoading(false);
      }
    }

    // Initial load
    loadStudents();
</script>
</body>
</html>
